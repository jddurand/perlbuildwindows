diff -Naur thai.old/tests/test_thbrk.c thai.new/tests/test_thbrk.c
--- thai.old/tests/test_thbrk.c	2021-12-20 20:07:41.000000000 +0100
+++ thai.new/tests/test_thbrk.c	2022-11-22 04:37:17.633360800 +0100
@@ -18,40 +18,73 @@
 };
 
 const Sample TestSamples[] = {
-    { u8"12% is 12 % and (12.00)% is (12.00) %",
+    { /* u8"12% is 12 % and (12.00)% is (12.00) %", */
+	  "\x31\x32\x25\x20\x69\x73\x20\x31\x32\x20\x25\x20\x61\x6e\x64\x20\x28\x31\x32\x2e\x30\x30\x29\x25\x20\x69\x73\x20\x28\x31\x32\x2e\x30\x30\x29\x20\x25",
       6, {4, 7, 12, 16, 25, 28},
-      u8"12% |is |12 % |and |(12.00)% |is |(12.00) %"},
-    { u8"ten% of all สิบ%ของทั้งหมด",
+      /* u8"12% |is |12 % |and |(12.00)% |is |(12.00) %"}, */
+	  "\x31\x32\x25\x20\x7c\x69\x73\x20\x7c\x31\x32\x20\x25\x20\x7c\x61\x6e\x64\x20\x7c\x28\x31\x32\x2e\x30\x30\x29\x25\x20\x7c\x69\x73\x20\x7c\x28\x31\x32\x2e\x30\x30\x29\x20\x25"
+    },
+    { /* u8"ten% of all สิบ%ของทั้งหมด", */
+	  "\x74\x65\x6e\x25\x20\x6f\x66\x20\x61\x6c\x6c\x20\xe0\xb8\xaa\xe0\xb8\xb4\xe0\xb8\x9a\x25\xe0\xb8\x82\xe0\xb8\xad\xe0\xb8\x87\xe0\xb8\x97\xe0\xb8\xb1\xe0\xb9\x89\xe0\xb8\x87\xe0\xb8\xab\xe0\xb8\xa1\xe0\xb8\x94",
       5, {5, 8, 12, 16, 19 },
-      u8"ten% |of |all |สิบ%|ของ|ทั้งหมด"},
-    { u8"$12 is $ 12 and $(12.00) is $ (12.00)",
+      /* u8"ten% |of |all |สิบ%|ของ|ทั้งหมด"}, */
+	  "\x74\x65\x6e\x25\x20\x7c\x6f\x66\x20\x7c\x61\x6c\x6c\x20\x7c\xe0\xb8\xaa\xe0\xb8\xb4\xe0\xb8\x9a\x25\x7c\xe0\xb8\x82\xe0\xb8\xad\xe0\xb8\x87\x7c\xe0\xb8\x97\xe0\xb8\xb1\xe0\xb9\x89\xe0\xb8\x87\xe0\xb8\xab\xe0\xb8\xa1\xe0\xb8\x94"
+    },
+    { /* u8"$12 is $ 12 and $(12.00) is $ (12.00)", */
+	  "\x24\x31\x32\x20\x69\x73\x20\x24\x20\x31\x32\x20\x61\x6e\x64\x20\x24\x28\x31\x32\x2e\x30\x30\x29\x20\x69\x73\x20\x24\x20\x28\x31\x32\x2e\x30\x30\x29",
       6, {4, 7, 12, 16, 25, 28},
-      u8"$12 |is |$ 12 |and |$(12.00) |is |$ (12.00)"},
-    { u8"Brazilian R$2 Nicaraguan C$10 U$S5 US$5 5$ 5 $ Micro$oft C++",
+      /* u8"$12 |is |$ 12 |and |$(12.00) |is |$ (12.00)"}, */
+	  "\x24\x31\x32\x20\x7c\x69\x73\x20\x7c\x24\x20\x31\x32\x20\x7c\x61\x6e\x64\x20\x7c\x24\x28\x31\x32\x2e\x30\x30\x29\x20\x7c\x69\x73\x20\x7c\x24\x20\x28\x31\x32\x2e\x30\x30\x29"
+    },
+    { /* u8"Brazilian R$2 Nicaraguan C$10 U$S5 US$5 5$ 5 $ Micro$oft C++", */
+	  "\x42\x72\x61\x7a\x69\x6c\x69\x61\x6e\x20\x52\x24\x32\x20\x4e\x69\x63\x61\x72\x61\x67\x75\x61\x6e\x20\x43\x24\x31\x30\x20\x55\x24\x53\x35\x20\x55\x53\x24\x35\x20\x35\x24\x20\x35\x20\x24\x20\x4d\x69\x63\x72\x6f\x24\x6f\x66\x74\x20\x43\x2b\x2b",
       8, {10, 14, 25, 30, 35, 40, 47, 57 },
-      u8"Brazilian |R$2 |Nicaraguan |C$10 |U$S5 |US$5 |5$ 5 $ |Micro$oft |C++"},
-    { u8"฿12 บ้างเขียน 12฿ หรือ ฿ 12 หรือ 12 ฿",
+      /* u8"Brazilian |R$2 |Nicaraguan |C$10 |U$S5 |US$5 |5$ 5 $ |Micro$oft |C++"}, */
+	  "\x42\x72\x61\x7a\x69\x6c\x69\x61\x6e\x20\x7c\x52\x24\x32\x20\x7c\x4e\x69\x63\x61\x72\x61\x67\x75\x61\x6e\x20\x7c\x43\x24\x31\x30\x20\x7c\x55\x24\x53\x35\x20\x7c\x55\x53\x24\x35\x20\x7c\x35\x24\x20\x35\x20\x24\x20\x7c\x4d\x69\x63\x72\x6f\x24\x6f\x66\x74\x20\x7c\x43\x2b\x2b"
+    },
+    { /* u8"฿12 บ้างเขียน 12฿ หรือ ฿ 12 หรือ 12 ฿", */
+	  "\xe0\xb8\xbf\x31\x32\x20\xe0\xb8\x9a\xe0\xb9\x89\xe0\xb8\xb2\xe0\xb8\x87\xe0\xb9\x80\xe0\xb8\x82\xe0\xb8\xb5\xe0\xb8\xa2\xe0\xb8\x99\x20\x31\x32\xe0\xb8\xbf\x20\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\xe0\xb8\xbf\x20\x31\x32\x20\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\x31\x32\x20\xe0\xb8\xbf",
       7, {4, 8, 14, 18, 23, 28, 33},
-      u8"฿12 |บ้าง|เขียน |12฿ |หรือ |฿ 12 |หรือ |12 ฿"},
-    { u8"฿(12.00) บ้างก็เขียน ฿ (12.00) หรือ (12.00)฿ หรือ (12.00) ฿",
+      /* u8"฿12 |บ้าง|เขียน |12฿ |หรือ |฿ 12 |หรือ |12 ฿"}, */
+	  "\xe0\xb8\xbf\x31\x32\x20\x7c\xe0\xb8\x9a\xe0\xb9\x89\xe0\xb8\xb2\xe0\xb8\x87\x7c\xe0\xb9\x80\xe0\xb8\x82\xe0\xb8\xb5\xe0\xb8\xa2\xe0\xb8\x99\x20\x7c\x31\x32\xe0\xb8\xbf\x20\x7c\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\x7c\xe0\xb8\xbf\x20\x31\x32\x20\x7c\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\x7c\x31\x32\x20\xe0\xb8\xbf"
+    },
+    { /* u8"฿(12.00) บ้างก็เขียน ฿ (12.00) หรือ (12.00)฿ หรือ (12.00) ฿", */
+	  "\xe0\xb8\xbf\x28\x31\x32\x2e\x30\x30\x29\x20\xe0\xb8\x9a\xe0\xb9\x89\xe0\xb8\xb2\xe0\xb8\x87\xe0\xb8\x81\xe0\xb9\x87\xe0\xb9\x80\xe0\xb8\x82\xe0\xb8\xb5\xe0\xb8\xa2\xe0\xb8\x99\x20\xe0\xb8\xbf\x20\x28\x31\x32\x2e\x30\x30\x29\x20\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\x28\x31\x32\x2e\x30\x30\x29\xe0\xb8\xbf\x20\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\x28\x31\x32\x2e\x30\x30\x29\x20\xe0\xb8\xbf",
       8, {9, 13, 15, 21, 31, 36, 45, 50},
-      u8"฿(12.00) |บ้าง|ก็|เขียน |฿ (12.00) |หรือ |(12.00)฿ |หรือ |(12.00) ฿"},
-    { u8"#hashtag #แฮชแท็ก #1 5# helloสวัสดี",
+      /* u8"฿(12.00) |บ้าง|ก็|เขียน |฿ (12.00) |หรือ |(12.00)฿ |หรือ |(12.00) ฿"}, */
+	  "\xe0\xb8\xbf\x28\x31\x32\x2e\x30\x30\x29\x20\x7c\xe0\xb8\x9a\xe0\xb9\x89\xe0\xb8\xb2\xe0\xb8\x87\x7c\xe0\xb8\x81\xe0\xb9\x87\x7c\xe0\xb9\x80\xe0\xb8\x82\xe0\xb8\xb5\xe0\xb8\xa2\xe0\xb8\x99\x20\x7c\xe0\xb8\xbf\x20\x28\x31\x32\x2e\x30\x30\x29\x20\x7c\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\x7c\x28\x31\x32\x2e\x30\x30\x29\xe0\xb8\xbf\x20\x7c\xe0\xb8\xab\xe0\xb8\xa3\xe0\xb8\xb7\xe0\xb8\xad\x20\x7c\x28\x31\x32\x2e\x30\x30\x29\x20\xe0\xb8\xbf"
+    },
+    { /* u8"#hashtag #แฮชแท็ก #1 5# helloสวัสดี", */
+	  "\x23\x68\x61\x73\x68\x74\x61\x67\x20\x23\xe0\xb9\x81\xe0\xb8\xae\xe0\xb8\x8a\xe0\xb9\x81\xe0\xb8\x97\xe0\xb9\x87\xe0\xb8\x81\x20\x23\x31\x20\x35\x23\x20\x68\x65\x6c\x6c\x6f\xe0\xb8\xaa\xe0\xb8\xa7\xe0\xb8\xb1\xe0\xb8\xaa\xe0\xb8\x94\xe0\xb8\xb5",
       5, {9, 18, 21, 24, 29},
-      u8"#hashtag |#แฮชแท็ก |#1 |5# |hello|สวัสดี"},
-    { u8"e.g. Ph.D.Engineering M.A.(Linguistics) ม.ค.มกราคมศกนี้",
+      /* u8"#hashtag |#แฮชแท็ก |#1 |5# |hello|สวัสดี"}, */
+	  "\x23\x68\x61\x73\x68\x74\x61\x67\x20\x7c\x23\xe0\xb9\x81\xe0\xb8\xae\xe0\xb8\x8a\xe0\xb9\x81\xe0\xb8\x97\xe0\xb9\x87\xe0\xb8\x81\x20\x7c\x23\x31\x20\x7c\x35\x23\x20\x7c\x68\x65\x6c\x6c\x6f\x7c\xe0\xb8\xaa\xe0\xb8\xa7\xe0\xb8\xb1\xe0\xb8\xaa\xe0\xb8\x94\xe0\xb8\xb5"
+    },
+    { /* u8"e.g. Ph.D.Engineering M.A.(Linguistics) ม.ค.มกราคมศกนี้", */
+	  "\x65\x2e\x67\x2e\x20\x50\x68\x2e\x44\x2e\x45\x6e\x67\x69\x6e\x65\x65\x72\x69\x6e\x67\x20\x4d\x2e\x41\x2e\x28\x4c\x69\x6e\x67\x75\x69\x73\x74\x69\x63\x73\x29\x20\xe0\xb8\xa1\x2e\xe0\xb8\x84\x2e\xe0\xb8\xa1\xe0\xb8\x81\xe0\xb8\xa3\xe0\xb8\xb2\xe0\xb8\x84\xe0\xb8\xa1\xe0\xb8\xa8\xe0\xb8\x81\xe0\xb8\x99\xe0\xb8\xb5\xe0\xb9\x89",
       8, {5, 10, 22, 26, 40, 44, 50, 52},
-      u8"e.g. |Ph.D.|Engineering |M.A.|(Linguistics) |ม.ค.|มกราคม|ศก|นี้"},
-    { u8"(s)he (may) meet person(s)",
+      /* u8"e.g. |Ph.D.|Engineering |M.A.|(Linguistics) |ม.ค.|มกราคม|ศก|นี้"}, */
+	  "\x65\x2e\x67\x2e\x20\x7c\x50\x68\x2e\x44\x2e\x7c\x45\x6e\x67\x69\x6e\x65\x65\x72\x69\x6e\x67\x20\x7c\x4d\x2e\x41\x2e\x7c\x28\x4c\x69\x6e\x67\x75\x69\x73\x74\x69\x63\x73\x29\x20\x7c\xe0\xb8\xa1\x2e\xe0\xb8\x84\x2e\x7c\xe0\xb8\xa1\xe0\xb8\x81\xe0\xb8\xa3\xe0\xb8\xb2\xe0\xb8\x84\xe0\xb8\xa1\x7c\xe0\xb8\xa8\xe0\xb8\x81\x7c\xe0\xb8\x99\xe0\xb8\xb5\xe0\xb9\x89"
+    },
+    { /* u8"(s)he (may) meet person(s)", */
+	  "\x28\x73\x29\x68\x65\x20\x28\x6d\x61\x79\x29\x20\x6d\x65\x65\x74\x20\x70\x65\x72\x73\x6f\x6e\x28\x73\x29",
       3, {6, 12, 17},
-      u8"(s)he |(may) |meet |person(s)"},
-    { u8"สวัสดีครับ กอ.รมน. นี่เป็นการทดสอบตัวเอง",
+      /* u8"(s)he |(may) |meet |person(s)"}, */
+	  "\x28\x73\x29\x68\x65\x20\x7c\x28\x6d\x61\x79\x29\x20\x7c\x6d\x65\x65\x74\x20\x7c\x70\x65\x72\x73\x6f\x6e\x28\x73\x29"
+    },
+    { /* u8"สวัสดีครับ กอ.รมน. นี่เป็นการทดสอบตัวเอง", */
+	  "\xe0\xb8\xaa\xe0\xb8\xa7\xe0\xb8\xb1\xe0\xb8\xaa\xe0\xb8\x94\xe0\xb8\xb5\xe0\xb8\x84\xe0\xb8\xa3\xe0\xb8\xb1\xe0\xb8\x9a\x20\xe0\xb8\x81\xe0\xb8\xad\x2e\xe0\xb8\xa3\xe0\xb8\xa1\xe0\xb8\x99\x2e\x20\xe0\xb8\x99\xe0\xb8\xb5\xe0\xb9\x88\xe0\xb9\x80\xe0\xb8\x9b\xe0\xb9\x87\xe0\xb8\x99\xe0\xb8\x81\xe0\xb8\xb2\xe0\xb8\xa3\xe0\xb8\x97\xe0\xb8\x94\xe0\xb8\xaa\xe0\xb8\xad\xe0\xb8\x9a\xe0\xb8\x95\xe0\xb8\xb1\xe0\xb8\xa7\xe0\xb9\x80\xe0\xb8\xad\xe0\xb8\x87",
       7, {6, 11, 19, 22, 26, 29, 34},
-      u8"สวัสดี|ครับ |กอ.รมน. |นี่|เป็น|การ|ทดสอบ|ตัวเอง"},
-    { u8"พันธุ์ข้าว กข43 น้ำตาลต่ำ กิโลละ 40บาท กระดาษ A4 ใน 4.3BSD",
+      /* u8"สวัสดี|ครับ |กอ.รมน. |นี่|เป็น|การ|ทดสอบ|ตัวเอง"}, */
+	  "\xe0\xb8\xaa\xe0\xb8\xa7\xe0\xb8\xb1\xe0\xb8\xaa\xe0\xb8\x94\xe0\xb8\xb5\x7c\xe0\xb8\x84\xe0\xb8\xa3\xe0\xb8\xb1\xe0\xb8\x9a\x20\x7c\xe0\xb8\x81\xe0\xb8\xad\x2e\xe0\xb8\xa3\xe0\xb8\xa1\xe0\xb8\x99\x2e\x20\x7c\xe0\xb8\x99\xe0\xb8\xb5\xe0\xb9\x88\x7c\xe0\xb9\x80\xe0\xb8\x9b\xe0\xb9\x87\xe0\xb8\x99\x7c\xe0\xb8\x81\xe0\xb8\xb2\xe0\xb8\xa3\x7c\xe0\xb8\x97\xe0\xb8\x94\xe0\xb8\xaa\xe0\xb8\xad\xe0\xb8\x9a\x7c\xe0\xb8\x95\xe0\xb8\xb1\xe0\xb8\xa7\xe0\xb9\x80\xe0\xb8\xad\xe0\xb8\x87"
+    },
+    { /* u8"พันธุ์ข้าว กข43 น้ำตาลต่ำ กิโลละ 40บาท กระดาษ A4 ใน 4.3BSD", */
+	  "\xe0\xb8\x9e\xe0\xb8\xb1\xe0\xb8\x99\xe0\xb8\x98\xe0\xb8\xb8\xe0\xb9\x8c\xe0\xb8\x82\xe0\xb9\x89\xe0\xb8\xb2\xe0\xb8\xa7\x20\xe0\xb8\x81\xe0\xb8\x82\x34\x33\x20\xe0\xb8\x99\xe0\xb9\x89\xe0\xb8\xb3\xe0\xb8\x95\xe0\xb8\xb2\xe0\xb8\xa5\xe0\xb8\x95\xe0\xb9\x88\xe0\xb8\xb3\x20\xe0\xb8\x81\xe0\xb8\xb4\xe0\xb9\x82\xe0\xb8\xa5\xe0\xb8\xa5\xe0\xb8\xb0\x20\x34\x30\xe0\xb8\x9a\xe0\xb8\xb2\xe0\xb8\x97\x20\xe0\xb8\x81\xe0\xb8\xa3\xe0\xb8\xb0\xe0\xb8\x94\xe0\xb8\xb2\xe0\xb8\xa9\x20\x41\x34\x20\xe0\xb9\x83\xe0\xb8\x99\x20\x34\x2e\x33\x42\x53\x44",
       12, {6, 11, 16, 22, 26, 30, 33, 35, 39, 46, 49, 52},
-      u8"พันธุ์|ข้าว |กข43 |น้ำตาล|ต่ำ |กิโล|ละ |40|บาท |กระดาษ |A4 |ใน |4.3BSD"},
-    { 0, 0, {}, 0 }
+      /* u8"พันธุ์|ข้าว |กข43 |น้ำตาล|ต่ำ |กิโล|ละ |40|บาท |กระดาษ |A4 |ใน |4.3BSD"}, */
+	  "\xe0\xb8\x9e\xe0\xb8\xb1\xe0\xb8\x99\xe0\xb8\x98\xe0\xb8\xb8\xe0\xb9\x8c\x7c\xe0\xb8\x82\xe0\xb9\x89\xe0\xb8\xb2\xe0\xb8\xa7\x20\x7c\xe0\xb8\x81\xe0\xb8\x82\x34\x33\x20\x7c\xe0\xb8\x99\xe0\xb9\x89\xe0\xb8\xb3\xe0\xb8\x95\xe0\xb8\xb2\xe0\xb8\xa5\x7c\xe0\xb8\x95\xe0\xb9\x88\xe0\xb8\xb3\x20\x7c\xe0\xb8\x81\xe0\xb8\xb4\xe0\xb9\x82\xe0\xb8\xa5\x7c\xe0\xb8\xa5\xe0\xb8\xb0\x20\x7c\x34\x30\x7c\xe0\xb8\x9a\xe0\xb8\xb2\xe0\xb8\x97\x20\x7c\xe0\xb8\x81\xe0\xb8\xa3\xe0\xb8\xb0\xe0\xb8\x94\xe0\xb8\xb2\xe0\xb8\xa9\x20\x7c\x41\x34\x20\x7c\xe0\xb9\x83\xe0\xb8\x99\x20\x7c\x34\x2e\x33\x42\x53\x44"
+    },
+    { 0, 0, { 0 }, 0 }
 };
 
 iconv_t utf8_to_tis_iconv;
diff -Naur thai.old/tests/thsort.c thai.new/tests/thsort.c
--- thai.old/tests/thsort.c	2021-12-20 20:07:41.000000000 +0100
+++ thai.new/tests/thsort.c	2022-11-22 05:02:06.012132700 +0100
@@ -86,14 +86,14 @@
         return 1;
     }
 
-    dataFile = fopen(DataFileName, "rt");
+    dataFile = fopen(DataFileName, "rb");
     if (dataFile == NULL) {
         fprintf(stderr, "Can't open file %s\n", DataFileName);
         perror("fopen");
         return 1;
     }
 
-    outFile = fopen(OutFileName, "wt");
+    outFile = fopen(OutFileName, "wb");
     if (outFile == NULL) {
         fprintf(stderr, "Can't open file %s for write\n", OutFileName);
         perror("fopen");
@@ -108,6 +108,6 @@
     fclose(outFile);
     fclose(dataFile);
 
-    return 0;
+    exit(0);
 }
 
